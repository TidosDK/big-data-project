apiVersion: apps/v1
kind: Deployment
metadata:
  name: dmi-producer
  namespace: bd-bd-gr-02
spec:
  replicas: 1
  selector:
    matchLabels:
      app: dmi-producer
  template:
    metadata:
      labels:
        app: dmi-producer
    spec:
      containers:
        - name: dmi-producer
          image: python:3.12-slim
          imagePullPolicy: IfNotPresent
          workingDir: /app
          command: ["bash", "-lc"]
          args:
            - >
              pip install --no-cache-dir confluent-kafka requests &&
              python /app/dmi-forecast_producer.py
          env:
            - name: KAFKA_BOOTSTRAP_SERVERS
              value: "kafka:9092"
            - name: KAFKA_TOPIC
              value: "meterological_observations"
            - name: API_URL
              value: "dmi.dk"
            - name: API_KEY
              value: 
            - name: POLL_SECONDS
              value: "60"
          volumeMounts:
            - name: producer-code
              mountPath: /app
      volumes:
        - name: producer-code
          configMap:
            name: dmi-producer-configmap
            items:
              - key: dmi-forecast_producer.py
                path: dmi-forecast_producer.py
